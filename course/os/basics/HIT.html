<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>操作系统 | NorthBoat</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/Blog/logo.jpg">
    <meta name="description" content="该博客已停更">
    
    <link rel="preload" href="/Blog/assets/css/0.styles.abe84f2e.css" as="style"><link rel="preload" href="/Blog/assets/js/app.5b462d01.js" as="script"><link rel="preload" href="/Blog/assets/js/2.6b285d51.js" as="script"><link rel="preload" href="/Blog/assets/js/54.17499480.js" as="script"><link rel="prefetch" href="/Blog/assets/js/10.ffffc335.js"><link rel="prefetch" href="/Blog/assets/js/100.31fa9a16.js"><link rel="prefetch" href="/Blog/assets/js/101.2e03c2ea.js"><link rel="prefetch" href="/Blog/assets/js/102.c91a2d9c.js"><link rel="prefetch" href="/Blog/assets/js/103.37a07655.js"><link rel="prefetch" href="/Blog/assets/js/104.da02b323.js"><link rel="prefetch" href="/Blog/assets/js/105.202b7598.js"><link rel="prefetch" href="/Blog/assets/js/106.27a009e9.js"><link rel="prefetch" href="/Blog/assets/js/107.1f98fc4c.js"><link rel="prefetch" href="/Blog/assets/js/108.58c5bc28.js"><link rel="prefetch" href="/Blog/assets/js/109.93c6f88b.js"><link rel="prefetch" href="/Blog/assets/js/11.1a4f7260.js"><link rel="prefetch" href="/Blog/assets/js/110.4288cfb9.js"><link rel="prefetch" href="/Blog/assets/js/111.80efb004.js"><link rel="prefetch" href="/Blog/assets/js/112.5dcc3a84.js"><link rel="prefetch" href="/Blog/assets/js/113.dc7ea58f.js"><link rel="prefetch" href="/Blog/assets/js/114.27030405.js"><link rel="prefetch" href="/Blog/assets/js/115.f2688d1d.js"><link rel="prefetch" href="/Blog/assets/js/116.6521a3f7.js"><link rel="prefetch" href="/Blog/assets/js/117.fee2d3ef.js"><link rel="prefetch" href="/Blog/assets/js/118.b8c936ff.js"><link rel="prefetch" href="/Blog/assets/js/119.25f1736e.js"><link rel="prefetch" href="/Blog/assets/js/12.a73e19a9.js"><link rel="prefetch" href="/Blog/assets/js/120.527e6dda.js"><link rel="prefetch" href="/Blog/assets/js/121.de77f07e.js"><link rel="prefetch" href="/Blog/assets/js/122.cf40de3c.js"><link rel="prefetch" href="/Blog/assets/js/123.c1b8a029.js"><link rel="prefetch" href="/Blog/assets/js/124.5e130ecb.js"><link rel="prefetch" href="/Blog/assets/js/125.7176a383.js"><link rel="prefetch" href="/Blog/assets/js/126.e31ce3bb.js"><link rel="prefetch" href="/Blog/assets/js/127.68215566.js"><link rel="prefetch" href="/Blog/assets/js/128.1f8f543f.js"><link rel="prefetch" href="/Blog/assets/js/129.ead46405.js"><link rel="prefetch" href="/Blog/assets/js/13.0fe329a7.js"><link rel="prefetch" href="/Blog/assets/js/130.812ec31b.js"><link rel="prefetch" href="/Blog/assets/js/131.57da5f16.js"><link rel="prefetch" href="/Blog/assets/js/132.717bef61.js"><link rel="prefetch" href="/Blog/assets/js/133.03cd25a2.js"><link rel="prefetch" href="/Blog/assets/js/14.1a86e8ba.js"><link rel="prefetch" href="/Blog/assets/js/15.484b65c2.js"><link rel="prefetch" href="/Blog/assets/js/16.682f178e.js"><link rel="prefetch" href="/Blog/assets/js/17.fa9336c5.js"><link rel="prefetch" href="/Blog/assets/js/18.39a4278d.js"><link rel="prefetch" href="/Blog/assets/js/19.e36a7c70.js"><link rel="prefetch" href="/Blog/assets/js/20.d9cf0aae.js"><link rel="prefetch" href="/Blog/assets/js/21.53064cbb.js"><link rel="prefetch" href="/Blog/assets/js/22.2ba17f83.js"><link rel="prefetch" href="/Blog/assets/js/23.fced31b8.js"><link rel="prefetch" href="/Blog/assets/js/24.340def84.js"><link rel="prefetch" href="/Blog/assets/js/25.58765567.js"><link rel="prefetch" href="/Blog/assets/js/26.8fe79f81.js"><link rel="prefetch" href="/Blog/assets/js/27.52df13b2.js"><link rel="prefetch" href="/Blog/assets/js/28.c9c7aaa9.js"><link rel="prefetch" href="/Blog/assets/js/29.7d46cab6.js"><link rel="prefetch" href="/Blog/assets/js/3.3025d786.js"><link rel="prefetch" href="/Blog/assets/js/30.a5cbbcd3.js"><link rel="prefetch" href="/Blog/assets/js/31.a3fe64fb.js"><link rel="prefetch" href="/Blog/assets/js/32.6f4b71df.js"><link rel="prefetch" href="/Blog/assets/js/33.f4870de4.js"><link rel="prefetch" href="/Blog/assets/js/34.a173ef06.js"><link rel="prefetch" href="/Blog/assets/js/35.a1137b9f.js"><link rel="prefetch" href="/Blog/assets/js/36.7a5ee652.js"><link rel="prefetch" href="/Blog/assets/js/37.253afd16.js"><link rel="prefetch" href="/Blog/assets/js/38.890dd74c.js"><link rel="prefetch" href="/Blog/assets/js/39.7a65a98a.js"><link rel="prefetch" href="/Blog/assets/js/4.2b42870a.js"><link rel="prefetch" href="/Blog/assets/js/40.f7532a18.js"><link rel="prefetch" href="/Blog/assets/js/41.aeb25632.js"><link rel="prefetch" href="/Blog/assets/js/42.6bcf4a55.js"><link rel="prefetch" href="/Blog/assets/js/43.348b83fb.js"><link rel="prefetch" href="/Blog/assets/js/44.6642a470.js"><link rel="prefetch" href="/Blog/assets/js/45.89e2574f.js"><link rel="prefetch" href="/Blog/assets/js/46.a9b0583a.js"><link rel="prefetch" href="/Blog/assets/js/47.70d0b6dc.js"><link rel="prefetch" href="/Blog/assets/js/48.d4201c5f.js"><link rel="prefetch" href="/Blog/assets/js/49.3381ed30.js"><link rel="prefetch" href="/Blog/assets/js/5.0fa05cd6.js"><link rel="prefetch" href="/Blog/assets/js/50.a429a35d.js"><link rel="prefetch" href="/Blog/assets/js/51.b58173cd.js"><link rel="prefetch" href="/Blog/assets/js/52.f05dc7dd.js"><link rel="prefetch" href="/Blog/assets/js/53.8391280d.js"><link rel="prefetch" href="/Blog/assets/js/55.9cd0e22f.js"><link rel="prefetch" href="/Blog/assets/js/56.5b17cbe1.js"><link rel="prefetch" href="/Blog/assets/js/57.f4ad5c1f.js"><link rel="prefetch" href="/Blog/assets/js/58.b013938d.js"><link rel="prefetch" href="/Blog/assets/js/59.1159eb77.js"><link rel="prefetch" href="/Blog/assets/js/6.e61f80cf.js"><link rel="prefetch" href="/Blog/assets/js/60.401d42b2.js"><link rel="prefetch" href="/Blog/assets/js/61.f0f7b454.js"><link rel="prefetch" href="/Blog/assets/js/62.fec8b981.js"><link rel="prefetch" href="/Blog/assets/js/63.1ca31b20.js"><link rel="prefetch" href="/Blog/assets/js/64.a028dfc6.js"><link rel="prefetch" href="/Blog/assets/js/65.b37496cb.js"><link rel="prefetch" href="/Blog/assets/js/66.7365dded.js"><link rel="prefetch" href="/Blog/assets/js/67.83d9d157.js"><link rel="prefetch" href="/Blog/assets/js/68.2992ee7b.js"><link rel="prefetch" href="/Blog/assets/js/69.301aded2.js"><link rel="prefetch" href="/Blog/assets/js/7.2e00c8c9.js"><link rel="prefetch" href="/Blog/assets/js/70.dcd1be9b.js"><link rel="prefetch" href="/Blog/assets/js/71.3fc4c611.js"><link rel="prefetch" href="/Blog/assets/js/72.1157b20c.js"><link rel="prefetch" href="/Blog/assets/js/73.8fafa20a.js"><link rel="prefetch" href="/Blog/assets/js/74.24093a1e.js"><link rel="prefetch" href="/Blog/assets/js/75.d8a1eadb.js"><link rel="prefetch" href="/Blog/assets/js/76.6f899447.js"><link rel="prefetch" href="/Blog/assets/js/77.bcee3cda.js"><link rel="prefetch" href="/Blog/assets/js/78.153a311c.js"><link rel="prefetch" href="/Blog/assets/js/79.3685754f.js"><link rel="prefetch" href="/Blog/assets/js/8.26736618.js"><link rel="prefetch" href="/Blog/assets/js/80.6bd9098a.js"><link rel="prefetch" href="/Blog/assets/js/81.725d4c95.js"><link rel="prefetch" href="/Blog/assets/js/82.a20dee6c.js"><link rel="prefetch" href="/Blog/assets/js/83.5f8df008.js"><link rel="prefetch" href="/Blog/assets/js/84.d71ced19.js"><link rel="prefetch" href="/Blog/assets/js/85.567f3716.js"><link rel="prefetch" href="/Blog/assets/js/86.aa9eabe6.js"><link rel="prefetch" href="/Blog/assets/js/87.d4b035f1.js"><link rel="prefetch" href="/Blog/assets/js/88.a8094f9e.js"><link rel="prefetch" href="/Blog/assets/js/89.6aa12ab8.js"><link rel="prefetch" href="/Blog/assets/js/9.6887a164.js"><link rel="prefetch" href="/Blog/assets/js/90.80e6f2ba.js"><link rel="prefetch" href="/Blog/assets/js/91.acd1dc71.js"><link rel="prefetch" href="/Blog/assets/js/92.94c291ae.js"><link rel="prefetch" href="/Blog/assets/js/93.50ebc5d2.js"><link rel="prefetch" href="/Blog/assets/js/94.4cf101b8.js"><link rel="prefetch" href="/Blog/assets/js/95.674db06a.js"><link rel="prefetch" href="/Blog/assets/js/96.fa4b1651.js"><link rel="prefetch" href="/Blog/assets/js/97.75bb55af.js"><link rel="prefetch" href="/Blog/assets/js/98.7f9892c0.js"><link rel="prefetch" href="/Blog/assets/js/99.1b210598.js">
    <link rel="stylesheet" href="/Blog/assets/css/0.styles.abe84f2e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Blog/" class="home-link router-link-active"><!----> <span class="site-name">NorthBoat</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Mine" class="dropdown-title"><span class="title">Mine</span> <span class="arrow down"></span></button> <button type="button" aria-label="Mine" class="mobile-dropdown-title"><span class="title">Mine</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/mine/notes/" class="nav-link">
  Notes
</a></li><li class="dropdown-item"><!----> <a href="/Blog/mine/project/" class="nav-link">
  Project
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Professional Courses" class="dropdown-title"><span class="title">Professional Courses</span> <span class="arrow down"></span></button> <button type="button" aria-label="Professional Courses" class="mobile-dropdown-title"><span class="title">Professional Courses</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/course/compilation/" class="nav-link">
  Compilation
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/os/" class="nav-link router-link-active">
  Operating System
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/net/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/datastruct/" class="nav-link">
  Datastruct
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/db/" class="nav-link">
  Data Base
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/organization/" class="nav-link">
  Organization
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Programming" class="dropdown-title"><span class="title">Programming</span> <span class="arrow down"></span></button> <button type="button" aria-label="Programming" class="mobile-dropdown-title"><span class="title">Programming</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/programming/c++/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/Blog/programming/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/Blog/programming/front/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/Blog/programming/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/Blog/programming/golang/" class="nav-link">
  Golang
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tools" class="mobile-dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/tools/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/Blog/tools/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/Blog/tools/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/Blog/tools/java/" class="nav-link">
  Java Tool
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Artificial Intelligence" class="dropdown-title"><span class="title">Artificial Intelligence</span> <span class="arrow down"></span></button> <button type="button" aria-label="Artificial Intelligence" class="mobile-dropdown-title"><span class="title">Artificial Intelligence</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/ai/toys/" class="nav-link">
  Toys
</a></li><li class="dropdown-item"><!----> <a href="/Blog/ai/course/" class="nav-link">
  Course
</a></li><li class="dropdown-item"><!----> <a href="/Blog/ai/python/" class="nav-link">
  Python
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Mine" class="dropdown-title"><span class="title">Mine</span> <span class="arrow down"></span></button> <button type="button" aria-label="Mine" class="mobile-dropdown-title"><span class="title">Mine</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/mine/notes/" class="nav-link">
  Notes
</a></li><li class="dropdown-item"><!----> <a href="/Blog/mine/project/" class="nav-link">
  Project
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Professional Courses" class="dropdown-title"><span class="title">Professional Courses</span> <span class="arrow down"></span></button> <button type="button" aria-label="Professional Courses" class="mobile-dropdown-title"><span class="title">Professional Courses</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/course/compilation/" class="nav-link">
  Compilation
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/os/" class="nav-link router-link-active">
  Operating System
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/net/" class="nav-link">
  Network
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/datastruct/" class="nav-link">
  Datastruct
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/db/" class="nav-link">
  Data Base
</a></li><li class="dropdown-item"><!----> <a href="/Blog/course/organization/" class="nav-link">
  Organization
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Programming" class="dropdown-title"><span class="title">Programming</span> <span class="arrow down"></span></button> <button type="button" aria-label="Programming" class="mobile-dropdown-title"><span class="title">Programming</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/programming/c++/" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/Blog/programming/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/Blog/programming/front/" class="nav-link">
  Front End
</a></li><li class="dropdown-item"><!----> <a href="/Blog/programming/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/Blog/programming/golang/" class="nav-link">
  Golang
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tools" class="mobile-dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/tools/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/Blog/tools/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/Blog/tools/api/" class="nav-link">
  API
</a></li><li class="dropdown-item"><!----> <a href="/Blog/tools/java/" class="nav-link">
  Java Tool
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Artificial Intelligence" class="dropdown-title"><span class="title">Artificial Intelligence</span> <span class="arrow down"></span></button> <button type="button" aria-label="Artificial Intelligence" class="mobile-dropdown-title"><span class="title">Artificial Intelligence</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Blog/ai/toys/" class="nav-link">
  Toys
</a></li><li class="dropdown-item"><!----> <a href="/Blog/ai/course/" class="nav-link">
  Course
</a></li><li class="dropdown-item"><!----> <a href="/Blog/ai/python/" class="nav-link">
  Python
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>操作系统基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Blog/course/os/basics/HIT.html" aria-current="page" class="active sidebar-link">操作系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#一、引论" class="sidebar-link">一、引论</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#_0、操作系统简介" class="sidebar-link">0、操作系统简介</a></li><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#_1、操作系统的启动" class="sidebar-link">1、操作系统的启动</a></li><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#_2、操作系统接口" class="sidebar-link">2、操作系统接口</a></li><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#_3、系统调用的实现" class="sidebar-link">3、系统调用的实现</a></li><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#_4、操作系统历史" class="sidebar-link">4、操作系统历史</a></li></ul></li><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#二、进程和线程" class="sidebar-link">二、进程和线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#_0、我们的任务" class="sidebar-link">0、我们的任务</a></li><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#_1、多进程引例" class="sidebar-link">1、多进程引例</a></li><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#_2、多进程图像" class="sidebar-link">2、多进程图像</a></li><li class="sidebar-sub-header"><a href="/Blog/course/os/basics/HIT.html#_3、用户级线程" class="sidebar-link">3、用户级线程</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="操作系统"><a href="#操作系统" class="header-anchor">#</a> 操作系统</h1> <h2 id="一、引论"><a href="#一、引论" class="header-anchor">#</a> 一、引论</h2> <h3 id="_0、操作系统简介"><a href="#_0、操作系统简介" class="header-anchor">#</a> 0、操作系统简介</h3> <h4 id="_0-1、沟通软件和硬件的桥梁"><a href="#_0-1、沟通软件和硬件的桥梁" class="header-anchor">#</a> 0.1、沟通软件和硬件的桥梁</h4> <p>第一层：硬件</p> <p>第二层：操作系统</p> <p>第三次：应用软件</p> <h4 id="_0-2、四个实验"><a href="#_0-2、四个实验" class="header-anchor">#</a> 0.2、四个实验</h4> <p>1、扩展线程：实现线程调度</p> <p>2、实现系统调用：将整个接口剥掉，添加</p> <p>3、实现虚存管理：扩展实现内存管理</p> <p>4、扩展文件系统：扩展实现一个文件管理</p> <h3 id="_1、操作系统的启动"><a href="#_1、操作系统的启动" class="header-anchor">#</a> 1、操作系统的启动</h3> <p>图灵机 ——&gt; 通用图灵机：取指执行（逻辑+数据）（取的是PC/IP指针指向的地址）</p> <h4 id="_1-1、将操作系统读入内存-取指执行-取内存中地址"><a href="#_1-1、将操作系统读入内存-取指执行-取内存中地址" class="header-anchor">#</a> 1.1、将操作系统读入内存（取指执行：取内存中地址）</h4> <p>打开计算机的第一条指令</p> <p>Bootsect.s：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Bootsect.s（读入操作系统）：

1、x86 PC刚开机时cpu处于实模式
2、开机时 （代码段寄存器）CS = 0xFFFF（指令指针寄存器）IP = 0x0000
3、寻址0xFFFF0（ROM BIOS映射区）：basic input output system（基本输入输出系统）
4、检查RAM、键盘、显示器、软硬磁盘
5、将磁盘0磁道0扇区读入0x7c00处（操作系统引导扇区：bootsect.s（汇编代码：对操作系统进行完整的控制））
6、设置 cs = 0x07c0   ip = 0x0000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>地址在因特尔结构下由两部分组成：段寄存器、段内偏移</p> <p>启动盘：boot扇区—&gt; setup的四个扇区—&gt; system模块（OS代码）</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>用 jumpi 0(ip)，SETUPSEG(cs)修改指针指向实现移动执行
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_1-2、初始化操作系统-针对硬件做出数据结构便于管理"><a href="#_1-2、初始化操作系统-针对硬件做出数据结构便于管理" class="header-anchor">#</a> 1.2、初始化操作系统（针对硬件做出数据结构便于管理）</h4> <p>1、setup.s：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>setup.s（完成OS启动前的设置，准备接管硬件）：

1、扩展内存大小：获取物理内存大小，管理内存
2、将system模块移到0地址，之后将一直存放在该处
3、最后一步指令，进入保护模式（启动32位寻址方式）：jmpi 0,8。把0赋给ip，把8赋给cs，在32位的汇编代码下，该语句将ip指向0地址处，即system所在地址，开始指向system模块中代码
4、gdt：t是table（表），通过硬件产生32位的地址，更快!
5、cr0寄存器：转换为32位寻址方式
6、cs成为选择子，对应表的下标
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>2、system模块</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1、bootsect.s -&gt;
2、setup.s -&gt; 
3、head.s（32位汇编）（操作系统进行初始化）-&gt;
4、main.c

//在head.s中初始化了GDT、IDT表

linux / makefile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>2*、汇编语言</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1、as86汇编
2、GNU as汇编
3、内嵌汇编
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>3、main.c：永远不会退出的程序</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">mem_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">trap_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">blk_dev_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">chr_dev_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">tty_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">time_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sched_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">buffer_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hd_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">floppy_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sti</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">move_to_user_mode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>mem_init()函数</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//执行内存的初始化，将内存记录在案</span>
<span class="token keyword">void</span> <span class="token function">mem_init</span><span class="token punctuation">(</span><span class="token keyword">long</span> start_mem<span class="token punctuation">,</span> <span class="token keyword">long</span> end_mem<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> PAGING_PAGES<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//mem_map数组</span>
        mem_map<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> USED<span class="token punctuation">;</span>
        i <span class="token operator">=</span> <span class="token function">MAP_NR</span><span class="token punctuation">(</span>start_mem<span class="token punctuation">)</span><span class="token punctuation">;</span>
        end_mem <span class="token operator">-=</span> start_mem<span class="token punctuation">;</span>
        <span class="token comment">//右移12位，减4k</span>
        end_mem <span class="token operator">&gt;&gt;=</span> <span class="token number">12</span><span class="token punctuation">;</span>
        <span class="token comment">//形成一个表格（mem_mep数组），记录哪些内存是使用了的，哪些没使用</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>end_mem <span class="token operator">--</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            mem_map<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>操作系统最大的错误是死机</p> <h3 id="_2、操作系统接口"><a href="#_2、操作系统接口" class="header-anchor">#</a> 2、操作系统接口</h3> <h4 id="_2-1、系统调用"><a href="#_2-1、系统调用" class="header-anchor">#</a> 2.1、系统调用</h4> <p>连接应用和硬件、信号转换、屏蔽细节</p> <p>用户使用计算机的方式：命令行、图形按钮、应用程序</p> <p>命令、桌面、shell都是一段程序（死程序）</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> cmd<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

图形按钮：实现消息机制、绘图功能 —— 一个包括画图功能的c程序

​<span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span>c
<span class="token comment">//硬件输入——&gt;消息队列</span>
<span class="token comment">/* WM_MOUSEDOWN：鼠标点击
   WinMain()
   (GetMessage)
*/</span>
<span class="token comment">//消息队列</span>
<span class="token function">WinProc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">case</span> WM_MOUSEDOWN<span class="token operator">:</span> <span class="token function">OnOK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//写入磁盘的功能</span>
<span class="token keyword">void</span> COutputDlg<span class="token operator">::</span><span class="token function">OnOK</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">GetDlgltemText</span><span class="token punctuation">(</span>IDC_EDIT1<span class="token punctuation">,</span>m_outStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">&quot;d:\\out.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span>m_outStr<span class="token punctuation">,</span>m_outStr<span class="token punctuation">.</span><span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>操作系统接口通过一些重要的函数（电路）和普通的c程序（插头）来连接操作系统和应用软件，这些重要的函数由操作系统来提供</p> <p>从外部来看，操作系统接口表现为函数调用，由于由系统提供，所以称为 <strong>系统调用</strong>（system_call）</p> <h4 id="_2-2、posix"><a href="#_2-2、posix" class="header-anchor">#</a> 2.2、POSIX</h4> <p>( Portable Operatin System Interface of Unix )</p> <p>操作系统标准，让应用程序在不同的操作系统上跑起来（可移植性）</p> <h3 id="_3、系统调用的实现"><a href="#_3、系统调用的实现" class="header-anchor">#</a> 3、系统调用的实现</h3> <p>用硬件划分内存段，规定内存特权级，信息储存于GDT表中。</p> <p>特权级分为 00、01、10、11（0、1、2、3），储存在段寄存器pc中cs的最后两位：数字越大，特权级越低</p> <p>只有当 CPL &lt; DPL 时，硬件才允许你访问目标段内存，各内存段特权级如下：核心态0、OS服务1/2、用户态3</p> <p>用户态程序通过中断指令（int 0X80指令）跨越特权级，其过程如下：计算机接收到用户程序中包含 int 指令的代码，进入 0x80（特权级为3） 入口，将pc指针中cs改为8（1000），特权级升为0，获取代码内容，找到指定编号，在内核中的函数数组 system_call 调用相应下标 函数，完成指令。程序结束将cs最后两位重新修改回11，退出本次执行</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>fn_ptr sys_call_table<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> 
<span class="token punctuation">{</span>
    sys_setup<span class="token punctuation">,</span> sys_exit<span class="token punctuation">,</span> sys_fork<span class="token punctuation">,</span> sys_read<span class="token punctuation">,</span> sys_write<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">whoami</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello os&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//穿过0x80到达内核变为</span>
<span class="token keyword">void</span> <span class="token function">sys_whoami</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printk</span><span class="token punctuation">(</span><span class="token string">&quot;hello os&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4、操作系统历史"><a href="#_4、操作系统历史" class="header-anchor">#</a> 4、操作系统历史</h3> <p>多进程线：IBSYS ——&gt; os/360 ——&gt; MULTICS ——&gt;Unix ——&gt; Linux</p> <p>文件管理线：QDOS ——&gt; MS-DOS ——&gt; Windos 3 ——&gt; Win95 ————&gt; Win10</p> <h2 id="二、进程和线程"><a href="#二、进程和线程" class="header-anchor">#</a> 二、进程和线程</h2> <h3 id="_0、我们的任务"><a href="#_0、我们的任务" class="header-anchor">#</a> 0、我们的任务</h3> <h4 id="_0-1、进程-view"><a href="#_0-1、进程-view" class="header-anchor">#</a> 0.1、进程 View</h4> <p>1、cpu管理</p> <p>2、内存管理</p> <h4 id="_0-2、file-view"><a href="#_0-2、file-view" class="header-anchor">#</a> 0.2、File View</h4> <p>1、磁盘管理</p> <p>2、终端设备管理</p> <h3 id="_1、多进程引例"><a href="#_1、多进程引例" class="header-anchor">#</a> 1、多进程引例</h3> <h4 id="_1-1、并发"><a href="#_1-1、并发" class="header-anchor">#</a> 1.1、并发</h4> <p>操作系统在管理/使用CPU的时候引出了多进程图像</p> <p>CPU的工作原理（取指执行）：一个程序存放在内存，设置一个地址（PC指针），CPU根据 PC 地址发出一个取指的命令，将 PC 指向地址放在地址总线上， 内存又将 PC 地址传回 CPU，此时CPU得到指令，开始执行。执行完毕后PC指针自动向磁盘后段移动</p> <p>管理CPU的最直观方法：设好PC初值为一段程序的开始地址 ——&gt; 这样会引出问题：IO指令特别慢</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> to<span class="token punctuation">,</span> <span class="token operator">*</span>fp<span class="token punctuation">,</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    to <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> to<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
        <span class="token function">fprintf</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> <span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>当10^6个计算指令中间穿插一个IO指令，CPU的利用率约在50％，因为在执行IO命令时CPU没事干，时间被浪费</p> <p>——&gt; 多道程序同时出发、交替执行</p> <p>当A碰到打印任务，将CPU执行权交给B，当B碰到打印任务同理；二者同时需要进行计算任务时才根据先后等待：利用率能达到80%</p> <p>以上过程被称为 <strong>并发</strong> （同时出发）</p> <p>通过修改寄存器PC指针的位置切换程序，同时记录信息便于切换回来</p> <p>运行的程序和静态的程序变的不一样了：需要记录运行的程序的运行状态（加上书签），而静态的程序就像未拆封的书</p> <h4 id="_1-2、进程"><a href="#_1-2、进程" class="header-anchor">#</a> 1.2、进程</h4> <p>即为上文提到的 “运行中的程序”</p> <p>我们需要用一个数据结构将进程区别于静态程序的所有不一样储存起来 ——&gt; PCB表（Process Control Block）</p> <p>OS中最重要的结构：PCB</p> <h3 id="_2、多进程图像"><a href="#_2、多进程图像" class="header-anchor">#</a> 2、多进程图像</h3> <h4 id="_2-1、多进程图像是什么"><a href="#_2-1、多进程图像是什么" class="header-anchor">#</a> 2.1、多进程图像是什么</h4> <p>多进程是操作系统的基本图像</p> <p>在main.c中，其最后一条指令：启动shell（Windows桌面）</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//在init()中，创建了第一个进程：shell（Windows桌面）</span>
<span class="token comment">//在shell再启动其他进程</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>启动shell后：一个命令启动一个进程，返回shell再启动其他进程</p> <h4 id="_2-2、多进程如何组织"><a href="#_2-2、多进程如何组织" class="header-anchor">#</a> 2.2、多进程如何组织</h4> <p>PCB + 状态 + 队列</p> <p>1、PCB表：储存队列以及进程状态</p> <p>2、队列：正在执行进程、就绪队列、磁盘等待队列</p> <p>3、进程的状态：</p> <p><img src="C:%5CUsers%5CNorthBoat%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210510173049546.png" alt="image-20210510173049546"></p> <h4 id="_2-3、多进程如何交替"><a href="#_2-3、多进程如何交替" class="header-anchor">#</a> 2.3、多进程如何交替</h4> <p>启动磁盘读写：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//将自身状态变为阻塞态</span>
pCur<span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token char">'W'</span><span class="token punctuation">;</span>
<span class="token comment">//将pCur放到DiskWaitQueue：阻塞队列</span>

<span class="token comment">//切换函数：完成上下切换</span>
<span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    pNew <span class="token operator">=</span> <span class="token function">getNext</span><span class="token punctuation">(</span>ReadyQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">switch_to</span><span class="token punctuation">(</span>pCur<span class="token punctuation">,</span> pNew<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>交替的三个部分：队列操作+调度+切换</p> <p>getNext()：<strong>调度</strong>（进程调度）（一般是调度队列最前的进程）（FIFO、Priority）</p> <p>CPU和PCB中的信息互相覆盖，扣住，实现进程的交替</p> <h4 id="_2-4、多进程如何影响"><a href="#_2-4、多进程如何影响" class="header-anchor">#</a> 2.4、多进程如何影响</h4> <p>所有的进程都存放在内存中（CPU的取指执行均发生在内存中），所有的进程特权级均为3，即相互之间的访问不受限制，我们通过映射表实现多进程地址空间的分离，即其地址数值为键，真实地址为值储存于映射表中，当多进程地址重合时，重合的时其键，而非其值，这样实现多进程的共存</p> <h4 id="_2-5、进程同步"><a href="#_2-5、进程同步" class="header-anchor">#</a> 2.5、进程同步</h4> <p>当多进程进行合作时，由于不停的交替任务，会造成数据有出入，混乱不堪</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>int count = 5;
生产者p
p.register = count;
p.register++;
count = p.register
消费者q
q.register = count;
q.register--;
count = q.register;

当q与p进行合作时
p.register = count;
p.register++;	//此时进程切换
q.register = count;
q.register--;	//此时进程再次切换
count = p.register;	   //最初p结束，切换至进程q
count = q.register

一顿操作下来count = 4;
而一回合生产者和消费者的操作按理说count应不变

以上即为进程无限制交替带来的混乱
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>解决这个问题，核心在于进程同步</p> <p>在上述引例，给count上锁：当count = p.register这一语句时被执行后，锁解开</p> <p>在每次交替时，检查count锁，若锁存在，则不允许切换</p> <h3 id="_3、用户级线程"><a href="#_3、用户级线程" class="header-anchor">#</a> 3、用户级线程</h3> <p>User Threads</p> <p>进程=指令执行序列+资源（映射表）</p> <p>进程的切换：指令的切换+映射表内存的切换（分治）</p> <p>PC通过映射表切换到不同指令</p> <p>只切指令，而不切表：</p> <p>表属于资源，即内存，我们希望在切换进程的时候只切换指令而不切换内存，这样切换速度将大大提升</p> <p>——&gt; 线程（Thread）：保留了并发的优点，避免了进程切换代价（切换内存导致的速度下降）</p> <p>一个地址空间包含多个执行序列实例：</p> <table><thead><tr><th>对于一个网页浏览器：</th></tr></thead> <tbody><tr><td>一个线程用来从服务器接收数据</td></tr> <tr><td>一个线程用来显示文本</td></tr> <tr><td>一个线程从用来处理图片</td></tr> <tr><td>一个线程用来显示图片</td></tr></tbody></table> <p>不同进程的运行速度不同，例如在加载大动画时文本已经加载好，提升用户的交互性</p> <p>若不交替执行，将等待很久，然后猛地一下加载好</p> <p>缓存区共享 ——&gt; 资源共享，所有数据放在一个地址处</p> <p>只切换指令，而非内存！</p> <p>接下来开始实现这个浏览器...</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">WebExplorer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> URL<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;http://cms.hit.edu.cn&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//申请共享缓存区</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> GetData<span class="token punctuation">,</span> URL<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> Show<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">GetData</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>URL<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">Show</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>交替实行</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/Blog/assets/js/app.5b462d01.js" defer></script><script src="/Blog/assets/js/2.6b285d51.js" defer></script><script src="/Blog/assets/js/54.17499480.js" defer></script>
  </body>
</html>
